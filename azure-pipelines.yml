trigger:
- main

pool:
  name: Default

variables:
  buildConfiguration: Release

steps:
# ---------------- CHECKOUT ----------------
- checkout: self

# ---------------- VERIFY AGENT ----------------
- script: |
    echo "Agent info:"
    hostname
    whoami
    dotnet --version
    echo "Sources directory:"
    echo $(Build.SourcesDirectory)
  displayName: 'Verify agent & environment'

# ---------------- DOTNET BUILD ----------------
- script: |
    echo "Artifact staging directory:"
    echo $(Build.ArtifactStagingDirectory)

    cd dotnet-app
    dotnet restore
    dotnet build --configuration $(buildConfiguration)
    dotnet publish \
      --configuration $(buildConfiguration) \
      --output $(Build.ArtifactStagingDirectory)/dotnet
  displayName: 'Build & Publish .NET App'

# ---------------- PUBLISH ARTIFACTS ----------------
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(Build.ArtifactStagingDirectory)
    artifactName: dotnet-build-artifacts
  displayName: 'Publish .NET Build Artifacts'
