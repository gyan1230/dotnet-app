trigger:
- main

pool:
  name: Default

variables:
  buildConfiguration: Release

steps:
# ---------------- CHECKOUT ----------------
- checkout: self

# ---------------- VERIFY AGENT ----------------
- script: |
    echo "Agent info:"
    hostname
    whoami
    dotnet --version
    echo "Repo root contents:"
    ls -la
  displayName: 'Verify self-hosted agent & repo'

# ---------------- DOTNET BUILD ----------------
- script: |
    cd dotnet-app
    dotnet restore
    dotnet build --configuration $(buildConfiguration)
    dotnet publish \
      --configuration $(buildConfiguration) \
      --output ../artifacts/dotnet
  displayName: 'Build & Publish .NET App'

# ---------------- PUBLISH ARTIFACTS ----------------
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: artifacts
    artifactName: dotnet-build-artifacts
  displayName: 'Publish .NET Build Artifacts'
